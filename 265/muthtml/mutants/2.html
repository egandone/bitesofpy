<!DOCTYPE html>
<html>
<head>
    <title>MutPy mutation report - mutation #2</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css">
    
<link href="http://alexgorbatchev.com/pub/sh/current/styles/shCore.css" rel="stylesheet" type="text/css" />
<link href="http://alexgorbatchev.com/pub/sh/current/styles/shThemeDefault.css" rel="stylesheet" type="text/css" />

    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
    
<script src="http://alexgorbatchev.com/pub/sh/current/scripts/shCore.js" type="text/javascript"></script>
<script src="http://alexgorbatchev.com/pub/sh/current/scripts/shBrushPython.js" type="text/javascript"></script>
<script type="text/javascript">
    SyntaxHighlighter.all();
    window.setTimeout(function () {
        
        $('.line.number30').attr('title', 'COI');
        
    }, 0);
</script>

</head>
<body>
    <div class="container">
        
<div class="page-header">
    <h1>Mutation #2</h1>
</div>
<h3>Details</h3>
<ul>
    <li>module - <code><module 'anagram' from 'C:\\work\\bitesofpy\\265\\anagram.py'></code></li>
    <li><span class="label label-success">killed</span> by <code>test_anagram.py::test_encrypt</code></li>
    
    <li>duration - 0.817 s</li>
    
    
    <li>tests run - 1</li>
    
</ul>

<h3>Exception traceback</h3>
<pre>cf = ClamyFernet(password=b'pybites', key=b'f57aTwKRF94hOPilYt2YwX5VZweCa4MDl3itL3gcLAY=')

    def test_encrypt(cf):
        assert cf.iterations == 100_000
        assert len(cf.salt) == 16
        assert cf.length == 32
        token = cf.encrypt(MESSAGE)
        og_message = cf.decrypt(token)
        assert len(token) == 120
        assert isinstance(token, bytes)
>       assert cf.key == KEYS[0]
E       AssertionError

test_anagram.py:34: AssertionError</pre>

<h3>Mutations</h3>
<ul>
    
    <li>COI - line 30</li>
    
</ul>
<h3>Mutant</h3>
<pre class="brush: python; first-line: 1; highlight: [30]; toolbar: false;">import base64
from collections import Counter
from cryptography.fernet import Fernet
from cryptography.hazmat.backends import default_backend
from cryptography.hazmat.primitives import hashes
from cryptography.hazmat.primitives.kdf.pbkdf2 import PBKDF2HMAC
from dataclasses import dataclass
from os import urandom
from typing import ByteString, Tuple, Optional


@dataclass
class ClamyFernet:
    '''Fernet implementation by clamytoe

    Takes a bytestring as a password and derives a Fernet
    key from it. If a key is provided, that key will be used.
    '''
    passwordByteStringb'pybites'
    keyOptional[ByteString]None
    
    def __post_init__(self):
        '''Initializes the class'''
        self.salt = urandom(16)
        self.algorithm = hashes.SHA512()
        self.length = 32
        self.iterations = 100000
        self.backend = default_backend()
        
        if not (self.key is None):
            self.key = base64.urlsafe_b64encode(self.kdf.derive(self.password))
    
    @property
    def kdf(self) -> PBKDF2HMAC:
        '''Derives the key from the password

        Uses PBKDF2HMAC to generate a secure key.
        '''
        return PBKDF2HMAC(algorithm=\
            self.algorithm, length=\
            self.length, salt=\
            self.salt, iterations=\
            self.iterations, backend=\
            self.backend)
    
    
    @property
    def clf(self):
        '''Generates a Fernet object'''
        return Fernet(self.key)
    
    def encrypt(self, message: str) -> ByteString:
        '''Encrypts the message passed to it'''
        return self.clf.encrypt(str.encode(message))
    
    def decrypt(self, token: ByteString) -> str:
        '''Decrypts the encrypted message passed to it'''
        return self.clf.decrypt(token).decode('utf-8')


@dataclass
class Anagram:
    '''Determines if two strings are valid anagrams'''
    phrase_onestr
    phrase_twostr
    _rejectTuple[(str, str, str, str)](' ', "'", '.', '-')
    cfOptional[ClamyFernet]None
    
    def __post_init__(self):
        if not (self.cf):
            self.cf = ClamyFernet()
        self.phrase_two = self.cf.encrypt(self.phrase_two)
    
    def _sanitize(self, text: str) -> str:
        '''Cleans up strings

        Removes characters that should not be considered as part
        of the anagram.
        '''
        for char in self._reject:
            text = text.replace(char, '')
        return text.lower()
    
    @property
    def valid(self) -> bool:
        '''Validates the two strings'''
        p2 = self.cf.decrypt(self.phrase_two)
        counter1 = Counter(self._sanitize(self.phrase_one))
        counter2 = Counter(self._sanitize(p2))
        return True if counter1 == counter2 else False</pre>

    </div>
</body>
</html>